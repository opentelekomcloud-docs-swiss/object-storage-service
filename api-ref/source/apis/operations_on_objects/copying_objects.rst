:original_name: obs_04_0082.html

.. _obs_04_0082:

Copying Objects
===============

Functions
---------

You can perform this operation to create a copy of an existing object in OBS.

Users can determine whether to copy the metadata of the source object to the target object (by default) or replace the metadata of the target object with the metadata contained in the request. The ACL of the source object is not copied to the target object. By default, the ACL of the target object is private. You can set an ACL for the target object by sending an API request.

The request for copying an object needs to carry the information about the bucket and object to be copied in the header field. The message body cannot be carried.

The target object size range is [0, 5 GB]. If the source object size exceeds 5 GB, you can only copy some objects using the Range API.

Versioning
----------

By default, **x-obs-copy-source** specifies the latest version of the source object. If the latest version of the source object has a deletion marker, the object is considered to have been deleted. You can add **versionId** to request header **x-obs-copy-source** to copy an object with the specified version ID.

If a bucket has versioning enabled, the system automatically generates a unique version ID for the requested object in this bucket and returns the version ID in response header **x-obs-version-id**. If versioning is suspended for the bucket, the object version number is **null**.

.. important::

   When the bucket versioning status is disabled, if you make a copy of object_A and save it as object_B, and an object named as object_B already exists, the new object_B will overwrite the existing one. After the copying is executed successfully, only new object_B can be downloaded because old object_B has been deleted. Therefore, before copying an object, ensure that there is no object with the same name as the object copy to prevent data from being deleted mistakenly. During the copying, object_A has no changes.

You cannot determine whether a request is executed successfully only using **status_code** in the header returned by HTTP. If 200 in **status_code** is returned, the server has received the request and starts to process the request. The body in the response shows whether the request is executed successfully. The request is executed successfully only when the body contains Etag; otherwise, the request fails to be executed.

Request Syntax
--------------

.. code-block:: text

   PUT /destinationObjectName HTTP/1.1
   Host: bucketname.obs.region.example.com
   x-obs-copy-source: /sourceBucket/sourceObject
   x-obs-metadata-directive: metadata_directive
   x-obs-copy-source-if-match: etag
   x-obs-copy-source-if-none-match: etag
   x-obs-copy-source-if-unmodified-since: time_stamp
   x-obs-copy-source-if-modified-since: time_stamp
   Authorization: signature
   Date: date

Request Parameters
------------------

This request contains no parameter.

Request Headers
---------------

You can add optional headers to specify the object to be copied. :ref:`Table 3 <obs_04_0007__table25197309>` describes the optional headers.

.. table:: **Table 1** Request headers

   +----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
   | Header                                 | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Mandatory             |
   +========================================+============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+=======================+
   | x-obs-acl                              | This header can be added to set access control policies for objects when copying the objects. The access control policies are the predefined common policies, including **private**, **public-read**, **public-read-write**.                                                                                                                                                                                                                                                                                                                               | No                    |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Type: string                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                       |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Example: x-obs-acl: acl                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                       |
   +----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
   | x-obs-grant-read                       | When creating an object, you can use this header to authorize all users in an account the permission to read objects and obtain object metadata.                                                                                                                                                                                                                                                                                                                                                                                                           | No                    |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Type: string                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                       |
   +----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
   | x-obs-grant-read-acp                   | When creating an object, you can use this header to authorize all users in an account the permission to obtain the object ACL.                                                                                                                                                                                                                                                                                                                                                                                                                             | No                    |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Type: string                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                       |
   +----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
   | x-obs-grant-write-acp                  | When creating an object, you can use this header to authorize all users in an account the permission to write the object ACL.                                                                                                                                                                                                                                                                                                                                                                                                                              | No                    |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Type: string                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                       |
   +----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
   | x-obs-grant-full-control               | When creating an object, you can use this header to authorize all users in an account the permission to read the object, obtain the object metadata, obtain the object ACL, and write the object ACL.                                                                                                                                                                                                                                                                                                                                                      | No                    |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Type: string                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                       |
   +----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
   | x-obs-copy-source                      | Indicates names of the source bucket and the source object. If the source object has multiple versions, the versionId parameter can be used to specify the desired version.                                                                                                                                                                                                                                                                                                                                                                                | Yes                   |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Type: string                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                       |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Constraint: URL encoding is required for handling Chinese characters.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                       |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Example: x-obs-copy-source: /source_bucket/sourceObject                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                       |
   +----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
   | x-obs-metadata- directive              | Indicates whether the metadata of the target object is copied from the source object or replaced with the metadata contained in the request.                                                                                                                                                                                                                                                                                                                                                                                                               | No                    |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Type: string                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                       |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Valid values: COPY and REPLACE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |                       |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Default value: COPY                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                       |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Example: x-obs-metadata-directive: metadata_directive                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                       |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Constraints: Values other than **COPY** or **REPLACE** result in an immediate 400-based error response. If you need to modify the metadata (the same for both the source and target objects), this parameter must be set to **REPLACE**, otherwise, the request is invalid and the server returns a 400 HTTP status code error. This parameter cannot be used to change an encrypted object to a non-encrypted object (the same for both the source and target objects). If you use this parameter to change the encrypted object, the system returns 400. |                       |
   +----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
   | x-obs-copy-source-if-match             | Copies the source object only if its ETag matches the one specified by this header. Otherwise, a 412 HTTP status code error (failed precondition) is returned.                                                                                                                                                                                                                                                                                                                                                                                             | No                    |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Type: string                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                       |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Example: x-obs-copy-source-if-match: etag                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                       |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Constraint: This parameter can be used with **x-obs-copy-source-if-unmodified-since** but not other conditional copy parameters.                                                                                                                                                                                                                                                                                                                                                                                                                           |                       |
   +----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
   | x-obs-copy-source-if-none-match        | Copies the object if its entity tag (ETag) matches the specified tag. Otherwise, the request returns a 412 HTTP status code error (failed precondition).                                                                                                                                                                                                                                                                                                                                                                                                   | No                    |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Type: string                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                       |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Example: x-obs-copy-source-if-none-match: etag                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |                       |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Constraint: This parameter can be used with **x-obs-copy-source-if-unmodified-since** but not other conditional copy parameters.                                                                                                                                                                                                                                                                                                                                                                                                                           |                       |
   +----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
   | x-obs-copy-source-if-unmodified- since | Copies the source object only if it has not been modified since the time specified by this header. Otherwise, a 412 HTTP status code error (failed precondition) is returned. This header can be used with **x-obs-copy-source-if-match**, but cannot be used with other conditional copy headers                                                                                                                                                                                                                                                          | No                    |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Type: HTTP time character string complying with the format specified at **http://www.ietf.org/rfc/rfc2616.txt**                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Example: x-obs-copy-source-if-unmodified -since: time-stamp                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |                       |
   +----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
   | x-obs-copy-source-if-modified-since    | Copies the source object only if it has not been modified since the time specified by this header. Otherwise, a 412 HTTP status code error (failed precondition) is returned. This header can be used with **x-obs-copy-source-if-none-match**, but cannot be used with other conditional copy headers                                                                                                                                                                                                                                                     | No                    |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Type: HTTP time character string complying with the format specified at **http://www.ietf.org/rfc/rfc2616.txt**                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Example: x-obs-copy-source-if-modified-since: time-stamp                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |                       |
   +----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
   | x-obs-website-redirect-location        | If a bucket is configured with the static website hosting function, it will redirect requests for this object to another object in the same bucket or to an external URL. OBS stores the value of this header in the object metadata.                                                                                                                                                                                                                                                                                                                      | No                    |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Type: string                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                       |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | There is no default value.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                       |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Constraint: The value must be prefixed by a slash (/), **http://**, or **https://**. The length of the value cannot exceed 2 KB.                                                                                                                                                                                                                                                                                                                                                                                                                           |                       |
   +----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
   | success_action_redirect                | Indicates the address (URL) to which a successfully responded request is redirected.                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | No                    |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | -  If the value is valid and the request is successful, OBS returns status code 303. **Location** contains **success_action_redirect** as well as the bucket name, object name, and object ETag.                                                                                                                                                                                                                                                                                                                                                           |                       |
   |                                        | -  If this parameter is invalid, OBS ignores this parameter. The response code is 204, and the **Location** is the object address.                                                                                                                                                                                                                                                                                                                                                                                                                         |                       |
   |                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                       |
   |                                        | Type: string                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                       |
   +----------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+

For details about other headers, see :ref:`Table 3 <obs_04_0007__table25197309>`.

Request Elements
----------------

This request contains no element.

Response Syntax
---------------

::

   HTTP/1.1 status_code
   Content-Type: application/xml
   Date: date
   Content-Length: length

   <?xml version="1.0" encoding="UTF-8" standalone="yes"?>
   <CopyObjectResult xmlns="http://obs.region.example.com/doc/2015-06-30/">
       <LastModified>modifiedDate</LastModified>
       <ETag>etagValue</ETag>
   </CopyObjectResult>

Response Headers
----------------

The response to the request uses common headers. For details, see :ref:`Table 1 <obs_04_0013__d0e686>`.

In addition to the common response headers, the following message headers may also be used. For details, see :ref:`Table 2 <obs_04_0082__table45458228101549>`.

.. _obs_04_0082__table45458228101549:

.. table:: **Table 2** Additional response header parameters

   +-----------------------------------+-----------------------------------+
   | Header                            | Description                       |
   +===================================+===================================+
   | x-obs-copy-source-version-id      | Version ID of the source object   |
   |                                   |                                   |
   |                                   | Type: string                      |
   +-----------------------------------+-----------------------------------+
   | x-obs-version-id                  | Version ID of the target object   |
   |                                   |                                   |
   |                                   | Type: string                      |
   +-----------------------------------+-----------------------------------+

Response Elements
-----------------

This response contains elements of a copy result. :ref:`Table 3 <obs_04_0082__table5815269>` describes the elements.

.. _obs_04_0082__table5815269:

.. table:: **Table 3** Response elements

   +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Element                           | Description                                                                                                                                                                                                                                                                                                                                                          |
   +===================================+======================================================================================================================================================================================================================================================================================================================================================================+
   | CopyObjectResult                  | Container for the copy result                                                                                                                                                                                                                                                                                                                                        |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   | Type: XML                                                                                                                                                                                                                                                                                                                                                            |
   +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | LastModified                      | Latest time when the object was modified                                                                                                                                                                                                                                                                                                                             |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   | Type: string                                                                                                                                                                                                                                                                                                                                                         |
   +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | ETag                              | 128-bit MD5 digest of the Base64 code of a new object. ETag is the unique identifier of the object content. It can be used to identify whether the object content is changed. For example, if ETag value is **A** when an object is uploaded and the ETag value has changed to **B** when the object is downloaded, it indicates that the object content is changed. |
   |                                   |                                                                                                                                                                                                                                                                                                                                                                      |
   |                                   | Type: string                                                                                                                                                                                                                                                                                                                                                         |
   +-----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Error Responses
---------------

No special error responses are returned. For details about error responses, see :ref:`Table 2 <obs_04_0115__d0e843>`.

Sample Request 1
----------------

Copy the object **srcobject** in bucket **bucket** to the **destobject** object in bucket **examplebucket**.

.. code-block:: text

   PUT /destobject HTTP/1.1
   User-Agent: curl/7.29.0
   Host: examplebucket.obs.region.example.com
   Accept: */*
   Date: WED, 01 Jul 2015 04:19:21 GMT
   Authorization: OBS H4IPJX0TQTHTHEBQQCEC:2rZR+iaH8xUewvUKuicLhLHpNoU=
   x-obs-copy-source: /bucket/srcobject

Sample Response 1
-----------------

::

   HTTP/1.1 200 OK
   Server: OBS
   x-obs-request-id: 001B21A61C6C00000134031BE8005293
   x-obs-id-2: MDAxQjIxQTYxQzZDMDAwMDAxMzQwMzFCRTgwMDUyOTNBQUFBQUFBQWJiYmJiYmJi
   Date: WED, 01 Jul 2015 04:19:21 GMT
   Content-Length: 249

   <?xml version="1.0" encoding="utf-8"?>
   <CopyObjectResult xmlns="http://obs.region.example.com/doc/2015-06-30/">
     <LastModified>2015-07-01T00:48:07.706Z</LastModified>
     <ETag>"507e3fff69b69bf57d303e807448560b"</ETag>
   </CopyObjectResult>

Sample Request 2
----------------

Copy a multi-version object and copy the object **srcobject** whose version number is **AAABQ4uBLdLc0vycq3gAAAAEVURTRkha** in bucket **bucket** to the **destobject** object in bucket **examplebucket**.

.. code-block:: text

   PUT /destobject HTTP/1.1
   User-Agent: curl/7.29.0
   Host: examplebucket.obs.region.example.com
   Accept: */*
   Date: WED, 01 Jul 2015 04:20:29 GMT
   Authorization: OBS H4IPJX0TQTHTHEBQQCEC:4BLYv+1UxfRSHBMvrhVLDszxvcY=
   x-obs-copy-source: /bucket/srcobject?versionId=AAABQ4uBLdLc0vycq3gAAAAEVURTRkha

Sample Response 2
-----------------

::

   HTTP/1.1 200 OK
   Server: OBS
   x-obs-request-id: DCD2FC9CAB78000001438B8A9C898B79
   x-obs-id-2: DB/qBZmbN6AIoX9mrrSNYdLxwvbO0tLR/l6/XKTT4NmZspzhWrwp5Z74ybAYVOgr
   Content-Type: application/xml
   x-obs-version-id: AAABQ4uKnOrc0vycq3gAAAAFVURTRkha
   x-obs-copy-source-version-id: AAABQ4uBLdLc0vycq3gAAAAEVURTRkha
   Date: WED, 01 Jul 2015 04:20:29 GMT
   Transfer-Encoding: chunked

   <?xml version="1.0" encoding="utf-8"?>
   <CopyObjectResult xmlns="http://obs.region.example.com/doc/2015-06-30/">
     <LastModified>2015-07-01T01:48:07.706Z</LastModified>
     <ETag>"507e3fff69b69bf57d303e807448560b"</ETag>
   </CopyObjectResult>
